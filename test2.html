<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CRYPT</title>

    <script src="https://cdn.jsdelivr.net/npm/tweetnacl-util@0.15.0/nacl-util.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tweetnacl@1.0.3/nacl.js"></script>
</head>

<body>

    <script>
        const message = 'Hello World!!!!';
        
        const naclPairA = nacl.box.keyPair();
        console.log( naclPairA );
        const naclPairB = nacl.box.keyPair();
        console.log( naclPairB );

        const privateKeyA = naclPairA.secretKey;
        const publicKeyA  = naclPairA.publicKey;
        const privateHexA = arrayToHex( privateKeyA );
        const publicHexA  = arrayToHex( publicKeyA );
        
        const privateKeyB = naclPairB.secretKey;
        const publicKeyB  = naclPairB.publicKey;
        const privateHexB = arrayToHex( privateKeyB );
        const publicHexB  = arrayToHex( publicKeyB );
        
        console.log( `Private A (${privateHexA.split( ' ' ).length * 8} bits): ${privateHexA}` );
        console.log( ` Public A (${publicHexA.split( ' ' ).length * 8} bits): ${publicHexA}` );

        console.log( `Private B (${privateHexB.split( ' ' ).length * 8} bits): ${privateHexB}` );
        console.log( ` Public B (${publicHexB.split( ' ' ).length * 8} bits): ${publicHexB}` );

        console.log( 'ENCRYPT...................' );
        const nonce = nacl.randomBytes( nacl.box.nonceLength );
        console.log( nonce );
        const messageBytes = nacl.util.decodeUTF8( message );
        console.log( messageBytes );
        const encrypted = nacl.box( messageBytes, nonce, publicKeyB, privateKeyA );
        console.log( encrypted );
        const encryptedFull = new Uint8Array( nonce.length + encrypted.length );
        encryptedFull.set( nonce );
        encryptedFull.set( encrypted, nonce.length );
        console.log( encryptedFull );
        const encryptedBase64 = nacl.util.encodeBase64( encryptedFull );
        console.log( encryptedBase64 );

        console.log( 'DECRYPT...................' );
        const encryptedBytes = nacl.util.decodeBase64( encryptedBase64 );
        console.log( encryptedBytes );
        const encryptedNonce = encryptedBytes.slice( 0, nacl.box.nonceLength );
        console.log( encryptedNonce );
        const encryptedMessage = encryptedBytes.slice( nacl.box.nonceLength, encryptedFull.length );
        console.log( encryptedMessage );
        const decrypted = nacl.box.open( encryptedMessage, encryptedNonce, publicKeyA, privateKeyB );
        console.log( decrypted );
        console.log( nacl.util.encodeUTF8( decrypted ) );

        function arrayToHex( array ) {
            const hex = [... new Uint8Array( array )]
                .map( x => x.toString( 16 ).padStart( 2, '0' ) )
                .join( ' ' );
            return hex;
        }
    </script>

</body>

</html> 